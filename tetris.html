<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- <link href="./fonts/7fonts.ru_DS-DIGI.TTF"> -->
	<!-- <link type="font/ttf" href="./fonts/362_LCDNOVA.ttf" rel="font/ttf"> -->
	<!-- <link href="toast.min.css" rel="stylesheet"> -->
	<!-- <script src="toast.min.js"></script> -->
    <title>Document</title>

    <style>

		@font-face {
			font-family: "DS-Digital";
			src: url("./fonts/DS-DIGIB.TTF");
		}

		.point {
			float: right;
			position: relative;
			font-family: "DS-Digital";
		}
		.point_l {
			float: right;
			position: relative;
			font-family: "DS-Digital";
		}
		.display-area {
			float: left;
			position: absolute;	
			top: 20px;
		}
		
        table{
            border-collapse: collapse;
            border-spacing: 0;
        }

        th, td {
			width: 8px;
			height: 8px;
			font-size: 40%;
            padding: 0;
			margin: 0;
            border: 0.1px solid #cdcdcd;
			cursor: default;
        }
		
		span:focus { 
			text-indent: -9999em; 
		}
	    span:focus {
			outline : none;
		}
		span:focus {
			outline: none;
			box-shadow: 0 0 1px 1px #4d90f0;
		}
		span:focus::-moz-placeholder {
			color: transparent;
		}
		span:focus::-webkit-input-placeholder {
			color: transparent;
		}
		
        canvas{
			font-size: 40%;

			margin: 0 auto;
			padding-left: 25%;
			padding-bottom: 5%;
			/* background:gray;
            border: none;
			cursor: crosshair; */
        }
		#container {
			padding: 10px;
			width: 155px;
			height: 220px;
			border: 0.1px solid #cdcdcd;
		}
		
    </style>
    <script type="text/javascript">  	
	
	function drawPast( id_canvas ) {
		var canvas = document.getElementById( id_canvas );
		try {
			if (canvas.getContext) {
				var ctx = canvas.getContext('2d');
				ctx.fillRect(0, 0, 8, 8);
			}		
		} catch (e) {
			null;
		}
	}
	
	function drawPastClear( id_canvas ) {
		var canvas = document.getElementById( id_canvas );
		try {
			if (canvas.getContext) {
				var ctx = canvas.getContext('2d');
				ctx.clearRect(0, 0, 8, 8);
			}		
		} catch (e) {
			null;
		}
	}
	
    </script>
</head>
<body>

<div id="container">
	<span class="point"></span>
	<br />
	<span class="point_l"></span>
	<script>
	
	var shape_  = [
					['04', '05', '06', '15'],
					['03', '04', '05', '06'],		// Zu
					['05', '14', '15', '24'],		// line
					['04', '05', '14', '15'],		// куб
				    ['06', '14', '15', '16']		// L
				  ];
				  
	
					
	var down_wall = [140,141,142,143,144,145,146,147,148,149];
	
	var shape_mod = [];
	var wall 	  = [];
	
	var _ID		  = 0;
	var _num   	  = 0;
	var _score    = 0;
	var _speed    = 1000;
	
		function init() {
		
			var _l    = 0;
			_num      = 0;
			_ID 	  = Math.floor(Math.random() * 5);
			shape_mod = shape_[_ID];

			document.querySelector('.point').innerHTML = 'S : ' + _score;
			
			if ( Number(_score) >= 500 ) {
				_speed = 800;
				_l = 1;
				
			} 
			if ( Number(_score) >= 1000 ) {
				_speed = 600;
				_l = 2;
			} 
			if ( Number(_score) >= 1500 ) {
				_speed = 500;
				_l = 3;
			} 
			if ( Number(_score) >= 2000 ) {
				_speed = 400;
				_l = 4;
			}
			if ( Number(_score) < 500 ) {
				_speed = 1000;
			} 
			
			document.querySelector('.point_l').innerHTML = 'L : ' + _l;
			
			if ( gameValidate(wall) == 0 ) {
				finishGame();
			} else {
				drawShape();
			}
		}
		
		function finishGame() {
			console.log('method finishGame()');
		}
	
		function drawArea()
		{
			document.writeln("<span class='display-area'><table>");		
			for (var j = 0; j < 15; j++) {
				document.writeln("<tr>");

				for (var i = 0; i < 10; i++) {
					document.writeln("<td id=" + j + "" + i + "><canvas id='canva_" + j + "" + i + "' width='4' height='4'></canvas></td>");
				}
				document.writeln("</tr>");
			}
			document.writeln("</table></span>");	
			
			init();
		}
		
		function gameValidate(args) 
		{
			var j = 0;

			shape_mod.forEach( (item) => {

				if ( args.findIndex ( (el) => el == item ) != -1 ) {
					j++;
				} 

			});

			return j == 0 ? 1 : 0;
		}

		function drawShape() 
		{			
			
			drawShapePaint( shape_mod );
			
			if ( gameValidate( down_wall ) == 1 ) {
				
				if ( gameValidate( wall.map(item => Number(item) - 10) ) == 1 ) {
				
					setTimeout( clearShape, _speed, shape_mod );	
					
					oneDownShape( shape_mod );
					
					setTimeout( drawShape, _speed );
					
				} 
				else {
					colovratiy();
				}	
			} 
			else {
				colovratiy();
			}	
		}
		
		function colovratiy() {
			wall = wall.concat( shape_mod );
			wall.sort( (a, b) => a - b );
			recurPoint( wall );
			init();		
		}
		
		function recurPoint(arr) {

			var tmp = [];
			var del = [];
			var box = arr;
			var j = 0;
			
			for ( var i = 0; i < box.length; i++ ) {
			
				var m = box[i].toString().split('');
				
				<!-- if (m.length == 3) { -->

					f = m[m.length - 2];
					//     console.log('f - ' + m);

					for ( var k = i; k < box.length; k++ ) {

						var m = box[k].toString().split('');

						//       console.log(m[m.length - 2] + m[m.length - 1]);

						if ( f == m[m.length - 2] && m[m.length - 1] == j ) {

							j++;

							if ( j == 10 ) {
								<!-- console.log('j - ' + j); -->
								 // извлечь начало массива и увеличиваем на 10
								tmp = arr.splice(0, k - 9).map(item => Number(item) + 10);

									   <!-- console.log('tmp - ' + tmp);       -->
									   <!-- console.log('arr - ' + arr); -->

								del = arr.splice(0, 10);
									   <!-- console.log('del - ' + del); -->
								clearShape(del);
								
								clearShape( tmp.map(item => Number(item) - 10) );
								
								// wall.splice(0, wall.length);
									   <!-- console.log(arr); -->
								wall = tmp.concat(arr); // соединяем с остатками

									   <!-- console.log('wall - ' + wall); -->
								wall.sort( (a, b) => a - b );

								drawShapePaint(wall);
								
								_score = _score + 10;
								
								console.log('3 - ' + wall);
								
								recurPoint(wall);
								
								
								k = box.length;
								i = box.length;
							}
						} 
						else {
							j = 0;
							break;
						}	
					}
				<!-- }  -->
				<!-- else { -->
					<!-- if ( m[m.length - 1] == j ) { -->
					
						<!-- j++; -->

						<!-- if ( j == 10 ) { -->
							<!-- console.log('j - ' + j); -->
							 <!-- // извлечь начало массива и увеличиваем на 10 -->
							<!-- tmp = arr.splice(0, i - 9).map(item => Number(item) + 10); -->

								   <!-- console.log('tmp - ' + tmp);       -->
								   <!-- console.log('arr - ' + arr); -->

							<!-- del = arr.splice(0, 10); -->
								   <!-- console.log('del - ' + del); -->
							<!-- clearShape(del); -->
							
							<!-- clearShape( tmp.map(item => Number(item) - 10) ); -->
								   <!-- console.log(arr); -->
							<!-- wall = tmp.concat(arr); // соединяем с остатками -->

								   <!-- console.log('wall - ' + wall); -->
							<!-- wall.sort( (a, b) => a - b ); -->

							<!-- drawShapePaint(wall); -->
							
							<!-- _score = _score + 10; -->
							
							<!-- console.log('2 - ' + wall); -->
							
							<!-- recurPoint(wall); -->
							
						<!-- } -->
					<!-- } -->
				<!-- } -->
			}
			console.log('all - ' + wall);
		}

		function animated(del) {
			setTimeout(clearShape, 100, del)
			setTimeout(drawShapePaint, 100, del);
			setTimeout(clearShape, 100, del)
			setTimeout(drawShapePaint, 100, del);
			setTimeout(clearShape, 100, del)
			setTimeout(drawShapePaint, 100, del);
			setTimeout(clearShape, 100, del)
		}
		
		function drawShapePaint(shape) {
			
			for ( var i = 0; i < shape.length; i++ ) {
				document.getElementById(shape[i].toString()).style.backgroundColor = 'gray';
				document.getElementById(shape[i].toString()).style.borderColor = 'black'
				drawPast( 'canva_' + shape[i] );	
			}
			
		}
		
		function clearShape(shape) {
		
			for ( var i = 0; i < shape.length; i++) {
				document.getElementById(shape[i].toString()).style.background = 'none';
				document.getElementById(shape[i].toString()).style.border = '0.1px solid #cdcdcd';
				drawPastClear( 'canva_' + shape[i] );	
			}
		}
		
		function oneLeftShape(shape) {
			var left_wall = [10,20,30,40,50,60,70,80,90,100,110,120,130,140];
			var j = 0;
			shape.forEach( (item) => {

				if ( left_wall.findIndex ( (el) => el == item ) != -1 ) {
					j++;
				} 

			});
			if ( j == 0 ) {
				if ( gameValidate( wall.map(item => Number(item) + 1) ) == 1 ) {
					shape_mod = shape.map(item => Number(item) - 1);			
				}
			}
		}
		
		function oneRightShape(shape) {
			var right_wall = [19,29,39,49,59,69,79,89,99,109,119,129,139,149];
			var j = 0;
			shape.forEach( (item) => {

				if ( right_wall.findIndex ( (el) => el == item ) != -1 ) {
					j++;
				} 

			});
			if ( j == 0 ) {
				if ( gameValidate( wall.map(item => Number(item) - 1) ) == 1 ) {
					shape_mod = shape.map(item => Number(item) + 1);
				}
			}
		}
		
		function oneDownShape(shape) {
			<!-- var right_wall = [19,29,39,49,59,69,79,89,99,109,119,129,139,149]; -->
			<!-- var j = 0; -->
			<!-- shape.forEach( (item) => { -->

				<!-- if ( down_wall.findIndex ( (el) => el == item ) != -1 ) { -->
					<!-- j++; -->
				<!-- }  -->

			<!-- }); -->
			<!-- if ( j == 0 ) { -->
				shape_mod = shape.map(item => Number(item) + 10);
			<!-- } -->
			<!-- } else { -->
				<!-- wall = wall.concat( shape_mod ); -->
				<!-- wall.sort( (a, b) => a - b ); -->
				<!-- recurPoint( wall ); -->
				<!-- init(); -->
			<!-- }	 -->
		}
		
		function rotateShape(arr, _ID) {
		
			var top_wall = [10,11,12,13,14,15,16,17,18,19];
			<!-- var top_wall = ['00','01','02','03','04','05','06','07','08','09']; -->
			var j = 0;
			
			arr.forEach( (item) => {

				if ( top_wall.findIndex ( (el) => el == item ) != -1 ) {
					j++;
				} 

			});
			
			if ( j == 0 ) {
				if ( _ID == 0 ) {
					var tmp = [
						[arr[0] + 9, arr[1], arr[2], arr[3]],				
						[arr[0] - 9, arr[1] - 1, arr[2] - 1, arr[3]], 		
						[arr[0], arr[1], arr[2], arr[3] - 9],			
						[arr[0], arr[1] + 1, arr[2] + 1, arr[3] + 9] 	
					];
					
					_num++;
					if ( _num == 4 ) {
						_num = 0;
					}

					shape_mod = tmp[_num];		
					
				} else if ( _ID == 1 ) {
					var tmp = [
						[arr[0] + 1, arr[1] + 10, arr[2] + 19, arr[3] + 28],
						[arr[0] - 1, arr[1] - 10, arr[2] - 19, arr[3] - 28]
					];
					_num == 0 ? shape_mod = tmp[_num++] : shape_mod = tmp[_num--];		
					
				} else if ( _ID == 2 ) {
					var tmp = [
						[arr[0] - 2, arr[1] - 10, arr[2] - 1, arr[3] - 9],
						[arr[0] + 2, arr[1] + 10, arr[2] + 1, arr[3] + 9],
						
					];
					_num == 0 ? shape_mod = tmp[_num++] : shape_mod = tmp[_num--];	
					
				} else if ( _ID == 3 ) {
					shape_mod = arr;
				} else if ( _ID == 4 ) {
					var tmp = [
						[arr[0] + 1, arr[1] + 8, arr[2] - 1, arr[3] - 10],		
						[arr[0] - 11, arr[1] - 9, arr[2], arr[3]], 					 
						[arr[0] + 9, arr[1], arr[2] - 9, arr[3] - 2],				
						[arr[0] + 1, arr[1] + 1, arr[2] + 10, arr[3] + 12] 	
					];

					_num++;
					if ( _num == 4 ) {
						_num = 0;
					}

					shape_mod = tmp[_num];
				}		
			}
		}
		
		drawArea();
		
		document.addEventListener('keydown', function(event) 
		{
			if (event.code == 'ArrowLeft') {
			
				oneLeftShape(shape_mod);
				
			} else if (event.code == 'ArrowRight') {
			
				oneRightShape(shape_mod);
				
			} else if (event.code == 'ArrowUp') {
			
				rotateShape(shape_mod, _ID);

			} else if (event.code == 'ArrowDown') {
				
				_speed = 10;
				<!-- init(); -->
				
			} else if (event.code == 'Space') {
			
				_speed = 10;
				
			}
		});	
		
	</script>
	
</div>



</body>
</html>
